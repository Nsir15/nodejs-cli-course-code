```txt
server got message-msg: <Buffer 6f e6 01 00 00 01 00 00 00 00 00 00 09 73 67 61 6c 69 2d 6d 63 73 0b 62 79 74 65 6f 76 65 72 73 65 61 03 63 6f 6d 00 00 1c 00 01>
server got message-rinfo: { address: '127.0.0.1', family: 'IPv4', port: 51882, size: 43 }
server got message-msg: <Buffer 99 c3 01 00 00 01 00 00 00 00 00 00 09 73 67 61 6c 69 2d 6d 63 73 0b 62 79 74 65 6f 76 65 72 73 65 61 03 63 6f 6d 00 00 01 00 01>
server got message-rinfo: { address: '127.0.0.1', family: 'IPv4', port: 64245, size: 43 }
server got message-msg: <Buffer ae 67 01 00 00 01 00 00 00 00 00 00 09 73 67 61 6c 69 2d 6d 63 73 0b 62 79 74 65 6f 76 65 72 73 65 61 03 63 6f 6d 00 00 41 00 01>
```

## 1

关闭占用端口53的其他服务 ：你可以使用以下命令查找占用端口53的进程:

```bash
sudo lsof -i :53
```

## DNS 报文结构图（请求/响应都类似）

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                  事务ID (Transaction ID)      |  2 字节
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
| QR | Opcode | AA | TC | RD | RA | Z | RCODE   |  2 字节 (Flags)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|           问题数 (QDCOUNT)                    |  2 字节
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|           回答数 (ANCOUNT)                    |  2 字节
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|           授权数 (NSCOUNT)                    |  2 字节
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|           附加数 (ARCOUNT)                    |  2 字节
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                                               |
/                   查询问题区                  /
/                (Queries Section)              /
|                                               |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                                               |
/                  回答区                       /
/                (Answers Section)              /
|                                               |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```
- 每一个“+--”代表一位（bit）。这一行有16个“格”，表示16位（二进制位），也就是2字节。
- 头部固定 12 字节，后面是可变长度的查询和回答等数据。

| 字段名 | 位范围 | 字节数 | 说明 |
| ---- | ---- | ---- | ---- |
| Transaction ID | 0-15 | 2 | 事务ID，匹配请求/响应 |
| Flags | 16-31 | 2 | 标志位（含QR,Opcode等） |
| QDCOUNT | 32-47 | 2 | 问题数 |
| ANCOUNT | 48-63 | 2 | 回答资源数 |
| NSCOUNT | 64-79 | 2 | 授权资源数 |
| ARCOUNT | 80-95 | 2 | 附加资源数 | 


query区域的结构：

| 0 - 15：Name（查询名，长度不固定） | 16 - 31：Class（查询类） |
| ---- | ---- |
| 0 - 15：Type（查询类型） |  | 